<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="raisetech.NewStudent.Management.repository.StudentRepository">
 <!-- 受講生の全件検索 -->
  <select id="search" resultType="raisetech.NewStudent.Management.data.Student">
    SELECT * FROM students
  </select>

  <!-- 受講生の単一検索 -->
  <select id="searchStudent" resultType="raisetech.NewStudent.Management.data.Student">
    SELECT * FROM students WHERE id = #{id}
  </select>

  <!-- 受講生コースの全件検索 -->
  <select id="searchStudentCoursesList" resultType="raisetech.NewStudent.Management.data.StudentCourses">
    SELECT * FROM students_courses
  </select>
<!-- 受講生コースの単一検索 -->
  <select id="searchStudentCourse" resultType="raisetech.NewStudent.Management.data.StudentCourses">
    SELECT * FROM students_courses WHERE id = #{studentId}
  </select>

  <!-- 受講生を削除 -->
  <delete id="deleteStudent" parameterType="int">
    DELETE FROM students WHERE id = #{id}
  </delete>

  <!-- 受講生コース名を更新 -->
  <update id="updateStudentCourse" parameterType="raisetech.NewStudent.Management.data.StudentCourses">
    UPDATE students_courses
    SET course_name = #{courseName}
    WHERE id = #{id}
  </update>

  <!-- 受講生を更新 -->
  <update id="updateStudent" parameterType="raisetech.NewStudent.Management.data.Student">
    UPDATE students
    SET name       = #{name},
    kana_name  = #{kanaName},
    nickname   = #{nickname},
    email      = #{email},
    area       = #{area},
    age        = #{age},
    sex        = #{sex},
    remark     = #{remark},
    isDeleted = #{isDeleted},
    is_canceled= #{canceled}
    WHERE id = #{id}
  </update>

  <!-- ★ 受講生を新規登録 -->
  <insert id="registerStudent"
    parameterType="raisetech.NewStudent.Management.data.Student"
    useGeneratedKeys="true"
    keyProperty="id"
    keyColumn="id">
    INSERT INTO students
    (name, kana_name, nickname, email, area, age, sex, remark, isDeleted, is_canceled)
    VALUES
    (#{name}, #{kanaName}, #{nickname}, #{email}, #{area}, #{age}, #{sex}, #{remark}, false, false)
  </insert>

  <!-- 受講生コースを新規登録 -->
  <insert id="registerStudentCourse"
    parameterType="raisetech.NewStudent.Management.data.StudentCourses"
    useGeneratedKeys="true"
    keyProperty="id"
    keyColumn="id">
    INSERT INTO students_courses
    (student_id, course_name, course_start_at, course_end_at)
    VALUES
    (#{studentId}, #{courseName}, #{courseStartAt,jdbcType=TIMESTAMP}, #{courseEndAt,jdbcType=TIMESTAMP})
  </insert>

</mapper>
